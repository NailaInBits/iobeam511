"use strict";

var RequestResults = require("../constants/RequestResults");
var Utils = require("../utils/Utils");

var _token = null;
var _requester = null;

module.exports = {

    initialize: function initialize(token, requester) {
        Utils.assertValidToken(token);
        Utils.assertValidRequester(requester);
        _token = token;
        _requester = requester;
    },

    query: function query(projectId, callback) {
        var opts = arguments.length <= 2 || arguments[2] === undefined ? {} : arguments[2];

        Utils.assertValidToken(_token);
        var endpoint = "/namespaces/";
        var context = {
            projectId: projectId,
            options: opts
        };
        var URL = _requester.getFullEndpoint(endpoint);

        var req = _requester.getRequest(URL, _token);
        if (opts.name) {
            req.query({ name: opts.name });
        } else if (opts.namespaceID) {
            endpoint = endpoint + opts.namespaceID;
        }

        var bodyHandler = function bodyHandler(resp, body, status) {
            if (status === RequestResults.SUCCESS) {
                resp.body = body;
            } else if (body && body.errors) {
                resp.error = body.errors[0].message;
            }
        };
        var innerCb = Utils.createInnerCb(callback, context, bodyHandler);
        _requester.execute(req, innerCb);
    }
};